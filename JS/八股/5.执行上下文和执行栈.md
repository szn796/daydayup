# 执行上下文和执行栈

## 1.执行上下文

执行上下文：代码【执行】的环境。

全局执行上下文：首次加载脚本时创建，包含全局变量对象(window)、作用域链和this

函数执行上下文：函数调用时创建，包含局部变量、作用域链和this。

## 2.执行上下文的生命周期

执行上下文的生命周期主要分为三个阶段：创建 -> 执行 -> 回收

一.创建阶段：

1.确定this（this在执行的时候才能确定，在定义阶段无法确定。相反，非this变量的访问在定义阶段就确定）

2.词法环境创建（环境记录器+外部环境引用、函数声明+let+const）

2.1.环境记录器：记录存储变量、函数声明和函数形参（let、const）

2.2.外部外界引用（简单点理解就是作用域链）

3.变量环境创建（环境记录器+外部环境引用、var）

补充：

1.词法环境和变量环境的区别在于：词法环境存储函数声明和变量（let、const）绑定，而变量环境仅仅存储var定义的变量和函数

2.变量提升在执行上下文的创建阶段，同名函数声明优先于变量声明，但会被后续的变量名赋值覆盖

二.执行阶段：

变量赋值、代码执行

三.回收阶段：

执行上下文出栈等待虚拟机回收执行上下文

## 3.执行栈

执行栈，用于存储在代码执行期间创建的所有执行上下文。

先进后出（羽毛球筒）。

当 JavaScript 引擎首次读取你的脚本时，它会创建一个全局执行上下文并将其推入当前的执行栈。每当发生一个函数调用，引擎都会为该函数创建一个新的执行上下文并将其推到当前执行栈的顶端。执行完毕后出栈。
